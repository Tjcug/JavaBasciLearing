# 1. 前言
最近研究Java基础知识。发现Java运行时常亮池以及自动装箱和自动拆箱中有些一些细节的地方，值得我们注意的地方，最为一个Java开发人员对于这种java基本特性我们需要去深入研究和掌握。

# 2. 运行时常量池
运行时常量池存在于方法区中，用于存放编译期生成的各种字面量和符号引用。

## 2.1 String Pool
String Pool是运行时常量池中虚拟出来的一个概念。

Java中字符串对象创建有两种形式，一种为字面量形式，如String str = "droid";，另一种就是使用new这种标准的构造对象的方法，如String str = new String("droid");，这两种方式我们在代码编写时都经常使用，尤其是字面量的方式。然而这两种实现其实存在着一些性能和内存占用的差别。这一切都是源于JVM为了减少字符串对象的重复创建，其维护了一个特殊的内存，这段内存被成为字符串常量池或者字符串字面量池。

### 2.1.1 工作原理
当代码中出现字面量形式创建字符串对象时，JVM首先会对这个字面量进行检查，如果字符串常量池中存在相同内容的字符串对象的引用，则将这个引用返回，否则新的字符串对象被创建，然后将这个引用放入字符串常量池，并返回该引用。

### 2.1.2 字面量创建形式
``` java
String str1 = "droid";
```

JVM检测这个字面量，这里我们认为没有内容为droid的对象存在。JVM通过字符串常量池查找不到内容为droid的字符串对象存在，那么会创建这个字符串对象，然后将刚创建的对象的引用放入到字符串常量池中,并且将引用返回给变量str1。如果接下来有这样一段代码
``` java
String str2 = "droid";
```

JVM还是要检测这个字面量，JVM通过查找字符串常量池，发现内容为”droid”字符串对象存在，于是将已经存在的字符串对象的引用返回给变量str2。注意这里不会重新创建新的字符串对象。

### 2.1.3 使用new创建
``` java
String str3 = new String("droid");
```

当我们使用了new来构造字符串对象的时候，不管字符串常量池中有没有相同内容的对象的引用，新的字符串对象都会创建。因此我们使用下面代码测试一下，

``` java
String str3 = new String("droid");
System.out.println(str1 == str3);
```

结果如我们所想，为false，表明这两个变量指向的为不同的对象。

### 2.1.4 intern
对于上面使用new创建的字符串对象，如果想将这个对象的引用加入到字符串常量池，可以使用intern方法。

调用intern后，首先检查字符串常量池中是否有该对象的引用，如果存在，则将这个引用返回给变量，否则将引用加入并返回给变量。
``` java
String str4 = str3.intern();
System.out.println(str4 == str1);
```

输出的结果为true。

-------

**对于基础类型的变量和常量：变量存储在栈中，常量存储在常量池中**。
如以下代码：
``` java
int i1 = 9; 
int i2 = 9; 
int i3 = 9;  
public static final int INT1 = 9; 
public static final int INT2 = 9; 
public static final int INT3 = 9;
```

